---
import type { GetStaticPaths } from "astro";
import MySiteLayout from "../../layouts/MySiteLayout.astro";
import BlogPost from "../../components/BlogPost.astro";

export const getStaticPaths = async () => {
	const allPosts = Object.values(import.meta.glob("../posts/*.md", { eager: true }));
	const uniqueTags = [...new Set(allPosts.map((post: any) => post.frontmatter.tags).flat())];

	return uniqueTags.map((tag) => {
		const filteredPosts = allPosts.filter((post: any) => post.frontmatter.tags?.includes(tag));
		return {
			params: { tag },
			props: { posts: filteredPosts },
		};
	});
};

const { tag } = Astro.params;
const { posts } = Astro.props;
const pageTitle = `Tag - ${tag}`;
---

<MySiteLayout title={pageTitle}>
	<section class="bg-white dark:bg-gray-900">
		<div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16">
			<div class="grid md:grid-cols-2 gap-8">
				{
					posts.map((post: any) => (
						<BlogPost
							title={post.frontmatter.title}
							url={post.url}
							imagUrl={post.frontmatter.image.url}
							imgAlt={post.frontmatter.image.alt}
							description={post.frontmatter.description}
						/>
					))
				}
			</div>
		</div>
	</section>
</MySiteLayout>
